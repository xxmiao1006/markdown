## CAP定理

CAP原则又称CAP定理，指的是在一个[分布式系统](https://baike.baidu.com/item/分布式系统/4905336)中， Consistency（一致性）、 Availability（可用性）、Partition tolerance（分区容错性），三者不可得兼。

一致性（C）：在[分布式系统](https://baike.baidu.com/item/分布式系统/4905336)中的所有数据备份，在同一时刻是否同样的值。（等同于所有节点访问同一份最新的数据副本）

可用性（A）：在集群中一部分节点故障后，[集群](https://baike.baidu.com/item/集群/5486962)整体是否还能响应[客户端](https://baike.baidu.com/item/客户端/101081)的读写请求。（对数据更新具备高可用性）

分区容忍性（P）：以实际效果而言，分区相当于对通信的时限要求。系统如果不能在时限内达成数据一致性，就意味着发生了分区的情况，必须就当前操作在C和A之间做出选择。



拜占庭将军问题
1982年，Leslie Lamport等科学家提出了著名的拜占庭将军问题（Byzantine failures），其讨论的是允许存在少数节点作恶场景下的一致性达成问题。简单描述下： 国土辽阔的拜占庭帝国，基于防御目的，将每支军队分别部署在全国各地。因为距离遥远，将军们只能靠信差传递消息。战争爆发时，拜占庭帝国军队的将军们必须全体一致的决定是否攻击某一支敌军，以获取作战胜利。然而将军们无法确定他们中是否存在叛徒，叛徒可能擅自变更进攻意向或者进攻时间，以破坏进攻的一致性，致使作战失败。在这种状态下，拜占庭将军们该商定一种怎样的远程沟通办法，以达到一致呢?



一般来说根据处理的异常情况不同，可以把共识算法分为两种类型，**一种是针对非拜占庭错误的，这类算法性能较高，但容错性较差，如Paxos、Raft等**；另一种是针对拜占庭错误的，这类算法往往容错性较高，但是性能相对较差，包括工作量证明（POW）、权益证明（POS）、委托权益证明（DPOS）、实用拜占庭容错算法（PBFT）等。处理拜占庭错误的算法有两种思路，一种是通过提高作恶成本以降低作恶节点出现的概率，如工作量证明、权益证明等，其中工作量证明是通过算力，而权益证明则是通过持有权益。另外一种是在允许一定的作恶节点存在的前提下，依然使得各节点之间达成共识，如实用拜占庭容错算法等。下面我们就来讲讲目前存在的主流共识算法。



## Paxos算法

Paxos 是第一个被证明的共识算法，其原理基于两阶段提交并进行扩展。 作为现在共识算法设计的鼻祖，以最初论文的难懂（算法本身并不复杂）出名。



Paxos是用于解决不可靠参与者（即可能发生故障）网络中的共识的协议，这里的**发生故障是指参与者节点都是无恶意节点**，**即会丢失、重发、不响应消息，但不会篡改消息**。**Paxos很好地解决了无恶意节点的分布式一致性问题。**(非拜占庭错误，理解上来说就是无恶意节点?只是可能发生故障)





[Raft算法原理](https://link.zhihu.com/?target=https%3A//www.codedump.info/post/20180921-raft/)

[Raft算法详解](https://zhuanlan.zhihu.com/p/32052223)

[采用zookeeper的EPHEMERAL节点机制实现服务集群的陷阱](https://developer.aliyun.com/article/227260)

[阿里巴巴为什么不用 ZooKeeper 做服务发现？](https://developer.aliyun.com/article/601745)

