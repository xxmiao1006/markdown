## Linux

详解`top` 命令

![top.png](https://wx1.sinaimg.cn/large/0072fULUgy1g9dln6eymlj30gf02idfu.jpg)

**top命令的结果分为两个部分**：

统计信息：前五行是系统整体的统计信息；
进程信息：统计信息下方类似表格区域显示的是各个进程的详细信息，默认5秒刷新一次。

统计信息说明：

第1行：Top 任务队列信息(系统运行状态及平均负载)，与uptime命令结果相同。
第1段：系统当前时间，例如：16:07:37
第2段：系统运行时间，未重启的时间，时间越长系统越稳定。
格式：up xx days, HH:MM
例如：241 days, 20:11, 表示连续运行了241天20小时11分钟
第3段：当前登录用户数，例如：1 user，表示当前只有1个用户登录
第4段：系统负载，即任务队列的平均长度，3个数值分别统计最近1，5，15分钟的系统平均负载

系统平均负载：单核CPU情况下，0.00 表示没有任何负荷，1.00表示刚好满负荷，超过1侧表示超负荷，理想值是0.7；
多核CPU负载：CPU核数 * 理想值0.7 = 理想负荷，例如：4核CPU负载不超过2.8何表示没有出现高负载。

第2行：Tasks 进程相关信息
第1段：进程总数，例如：Tasks: 231 total, 表示总共运行231个进程
第2段：正在运行的进程数，例如：1 running,
第3段：睡眠的进程数，例如：230 sleeping,
第4段：停止的进程数，例如：0 stopped,
第5段：僵尸进程数，例如：0 zombie

第3行：Cpus CPU相关信息，如果是多核CPU，按数字1可显示各核CPU信息，此时1行将转为Cpu核数行，数字1可以来回切换。
第1段：us 用户空间占用CPU百分比，例如：Cpu(s): 12.7%us,
第2段：sy 内核空间占用CPU百分比，例如：8.4%sy,
第3段：ni 用户进程空间内改变过优先级的进程占用CPU百分比，例如：0.0%ni,
第4段：id 空闲CPU百分比，例如：77.1%id,
第5段：wa 等待输入输出的CPU时间百分比，例如：0.0%wa,
第6段：hi CPU服务于硬件中断所耗费的时间总额，例如：0.0%hi,
第7段：si CPU服务软中断所耗费的时间总额，例如：1.8%si,
第8段：st Steal time 虚拟机被hypervisor偷去的CPU时间（如果当前处于一个hypervisor下的vm，实际上hypervisor也是要消耗一部分CPU处理时间的）

第4行：Mem 内存相关信息（Mem: 12196436k total, 12056552k used, 139884k free, 64564k buffers）
第1段：物理内存总量，例如：Mem: 12196436k total,
第2段：使用的物理内存总量，例如：12056552k used,
第3段：空闲内存总量，例如：Mem: 139884k free,
第4段：用作内核缓存的内存量，例如：64564k buffers

第5行：Swap 交换分区相关信息（Swap: 2097144k total, 151016k used, 1946128k free, 3120236k cached）
第1段：交换区总量，例如：Swap: 2097144k total,
第2段：使用的交换区总量，例如：151016k used,
第3段：空闲交换区总量，例如：1946128k free,
第4段：缓冲的交换区总量，3120236k cached

### top命令选项
-b：以批处理模式操作；
-c：显示完整的治命令；
-d：屏幕刷新间隔时间；
-I：忽略失效过程；
-s：保密模式；
-S：累积模式；
-i<时间>：设置间隔时间；
-u<用户名>：指定用户名；
-p<进程号>：指定进程；
-n<次数>：循环显示的次数。

### top命令交互

常用交互操作

* 基础操作

1：显示CPU详细信息，每核显示一行
d / s ：修改刷新频率，单位为秒
h：可显示帮助界面
n：指定进程列表显示行数，默认为满屏行数
q：退出top

* 面板隐藏显示

l：隐藏/显示第1行负载信息；
t：隐藏/显示第2~3行CPU信息；
m：隐藏/显示第4~5行内存信息；

* 进程列表排序

M：根据驻留内存大小进行排序；
P：根据CPU使用百分比大小进行排序；
T：根据时间/累计时间进行排序；

### 网络模式-桥接模式配置

什么是桥接模式？桥接模式就是将主机网卡与虚拟机虚拟的网卡利用虚拟网桥进行通信。在桥接的作用下，类似于把物理主机虚拟为一个交换机，所有桥接设置的虚拟机连接到这个交换机的一个接口上，物理主机也同样插在这个交换机当中，所以所有桥接下的网卡与网卡都是交换模式的，相互可以访问而不干扰。在桥接模式下，虚拟机ip地址需要与主机在同一个网段，如果需要联网，则网关与DNS需要与主机网卡一致。其网络结构如下图所示：

![桥接模式.png](https://wx1.sinaimg.cn/large/0072fULUgy1gaa2ljwstej30xc0n6q53.jpg)

接下来，我们就来实际操作，如何设置桥接模式。

首先，安装完系统之后，在开启系统之前，点击“编辑虚拟机设置”来设置网卡模式。

点击“网络适配器”，选择“桥接模式”，然后“确定”

在进入系统之前，我们先确认一下主机的ip地址、网关、DNS等信息。

然后，进入系统编辑网卡配置文件，命令为vi /etc/sysconfig/network-scripts/ifcfg-eth0

![虚拟网卡.jpg](https://wx1.sinaimg.cn/large/0072fULUgy1gaa2nldgyzj30in08hdge.jpg)

编辑完成，保存退出，然后重启虚拟机网卡，使用ping命令ping外网ip，测试能否联网。

```bash
/etc/init.d/network restart
```

